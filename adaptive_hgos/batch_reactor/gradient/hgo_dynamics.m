function dstate = hgo_dynamics(~, state, Ae, Be, gamma, M, mu, alpha, beta, ...
    tau)
n = 3;

z = state(1:n);
hx = state(n+1: 2*n);
m = length(get_psi(hx, alpha, beta));
hy = hx(1);
lam = state(2*n + 1: 2*n + m);
hz = state(2*n+m+1:2*n+m+n);

psi = get_psi(hx, alpha, beta);
   
y = (821/25) .* z(1) + (821 / 25) .* z(2) + (821 / 25) .* z(3);

H = [0; 0; 1];

dz = [
    (-1/2).*z(1)+(1/20).*z(2).*z(3);
    (1/2).*z(1)+(-2/5).*z(2).^2+(1/50).*z(3)+(-1/20).*z(2).*z(3);
    (1/2).*z(1)+(1/5).*z(2).^2+(-1/100).*z(3)+(-1/20).*z(2).*z(3);
];

dhz = Ae * hx + Be * y + H * lam' * psi;

dlamb = grad_alg(lam, (hy - y), psi, M, gamma, tau);

J = [
    (821/25), (821/25), (821/25);(821/50), (-1642/125).*hz(2)+(-821/500) ...
        .*hz(3), (821/2500)+(-821/500).*hz(2);
    (-40229/5000)+(-7389/1000).*hz(2)+(-821/1000).*hz(3), ...
        (-7389/1000).*hz(1)+(821/6250).*hz(2)+(7389/500).*hz(2).^2+ ...
        (13957/25000).*hz(3)+(13957/5000).*hz(2).*hz(3)+ ...
        (821/10000).*hz(3).^2, (-821/250000)+(-821/1000).*hz(1)+ ...
        (13957/25000).*hz(2)+(13957/10000).*hz(2).^2+(-821/12500).*hz(3)+ ...
        (821/5000).*hz(2).*hz(3)
];
    
Ob = [
    (821/25).*hz(1)+(821/25).*hz(2)+(821/25).*hz(3);
    (821/50).*hz(1)+(-821/125).*hz(2).^2+(821/2500).*hz(3)+ ...
        (-821/500).*hz(2).*hz(3);
    (-40229/5000).*hz(1)+(-7389/1000).*hz(1).*hz(2)+(821/12500).*hz(2).^2+ ...
        (2463/500).*hz(2).^3+(-821/250000).*hz(3)+(-821/1000).*hz(1).*hz(3)+ ...
        (13957/25000).*hz(2).*hz(3)+(13957/10000).*hz(2).^2.*hz(3)+ ...
        (-821/25000).*hz(3).^2+(821/10000).*hz(2).*hz(3).^2
];

f = [
    (-1/2).*hz(1)+(1/20).*hz(2).*hz(3);
    (1/2).*hz(1)+(-2/5).*hz(2).^2+(1/50).*hz(3)+(-1/20).*hz(2).*hz(3);
    (1/2).*hz(1)+(1/5).*hz(2).^2+(-1/100).*hz(3)+(-1/20).*hz(2).*hz(3)
];

dhx = f + mu * J' * (hx - Ob);

dstate = [dz; dhz; dlamb; dhx];
end
